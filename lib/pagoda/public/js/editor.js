// Generated by CoffeeScript 1.4.0
(function() {

  $(document).ready(function() {
    var handle_events, init, keyboard_events, save_post, set_save_button, show_shortcuts;
    key.filter = function(e) {
      return true;
    };
    set_save_button = function(status) {
      if (status === 'saving') {
        $('#save-button').val('Saving');
        return $('#save-button').addClass('saving');
      } else if (status === 'saved') {
        $('#save-button').val('Saved');
        $('#save-button').removeClass('saving');
        return setTimeout((function() {
          return $('#save-button').val('Save');
        }), 1000);
      } else if (status === 'error') {
        $('#save-button').val('Error');
        $('#save-button').removeClass('saving');
        return setTimeout((function() {
          return set_save_button('saved');
        }), 2000);
      }
    };
    save_post = function() {
      var post_obj;
      set_save_button('saving');
      post_obj = {
        post: {
          title: $('#post_title').val(),
          content: $('#post_content').val(),
          name: $('#post_name').val()
        },
        ajax: true
      };
      try {
        $.post('/save-post', post_obj, function(data) {
          var response;
          response = $.parseJSON(data);
          if (response['status'] === 'OK') {
            return setTimeout((function() {
              return set_save_button('saved');
            }), 1000);
          } else {
            return set_save_button('error');
          }
        });
      } catch (error) {
        set_save_button('error');
      }
      return console.log(post_obj);
    };
    handle_events = function() {
      $('#post-editor #post_title').autosize({
        append: "\n"
      });
      $("#fullscreen").click(function(e) {
        return screenfull.request();
      });
      screenfull.onchange = function() {
        if (screenfull.isFullscreen) {
          $('#fullscreen').hide();
          return setTimeout(function() {
            var rows;
            console.log($(window).height());
            rows = Math.ceil($(window).height() / 40);
            return $('#post_content').attr('rows', rows);
          }, 1000);
        } else {
          $('#fullscreen').show();
          return $('#post_content').attr('rows', 18);
        }
      };
      return $('.delete-button').click(function() {
        if (!confirm("Confirm delete?")) {
          return false;
        }
      });
    };
    keyboard_events = function() {
      key('⌘+enter, ctrl+enter', function(e) {
        return screenfull.toggle();
      });
      return key('⌘+s, ctrl+s', function(e) {
        if (window.location.pathname.indexOf('edit') === -1) {
          $('.edit_post').submit();
        } else {
          save_post();
        }
        return false;
      });
    };
    show_shortcuts = function() {
      var fulls_shortcut, is_mac, save_shortcut, special_key;
      is_mac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
      special_key = is_mac ? '⌘' : 'ctrl';
      save_shortcut = special_key + '+S';
      fulls_shortcut = special_key + '+Enter';
      $('#save-button').attr('title', save_shortcut);
      $('#fullscreen').attr('title', fulls_shortcut);
      $("#save-button").tipTip({
        delay: 200
      });
      return $("#fullscreen").tipTip({
        delay: 200,
        defaultPosition: 'right'
      });
    };
    init = function() {
      handle_events();
      keyboard_events();
      return show_shortcuts();
    };
    return init();
  });

}).call(this);
